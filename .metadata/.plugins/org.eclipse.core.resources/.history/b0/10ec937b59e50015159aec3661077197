package controller;

import java.awt.BorderLayout;
import java.io.IOException;
import java.rmi.NotBoundException;
import java.rmi.RemoteException;

import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.JTree;
import javax.swing.tree.DefaultTreeModel;
import javax.swing.tree.TreeNode;
import javax.swing.tree.TreeSelectionModel;

import app.Project;
import app.ProjectConventionException;
import epi.ServerInterface;

/**
 * Select an existing project on the server
 * @author briceaminou
 *
 */
public class SelectExistingProjectController {
	
	private final JTree tree = new JTree();
	
	public SelectExistingProjectController(){
	}
	
	public Project show() throws ProjectConventionException, RemoteException, IOException, NotBoundException{
		JPanel panel = new JPanel();
		panel.setLayout(new BorderLayout(0, 0));
		tree.getSelectionModel().setSelectionMode(TreeSelectionModel.SINGLE_TREE_SELECTION);
		panel.add(tree);
		
		DefaultTreeModel model = (DefaultTreeModel)tree.getModel();
		model.setRoot((TreeNode)ServerInterface.getInstance().get_stub().getScratchTreeStructure().getModel().getRoot());
		
		int result = JOptionPane.showConfirmDialog(null, panel,"Sync folder",JOptionPane.OK_CANCEL_OPTION,JOptionPane.PLAIN_MESSAGE);
		if(result==JOptionPane.OK_OPTION){
			Project project = new Project(tree.getSelectionPath().getLastPathComponent().toString());
			return project;
		}
		return null;
	}

}
