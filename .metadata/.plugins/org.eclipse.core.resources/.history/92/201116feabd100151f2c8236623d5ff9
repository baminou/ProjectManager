package controller;

import java.awt.Component;
import java.awt.Container;
import java.awt.event.KeyEvent;
import java.awt.event.KeyListener;
import java.io.File;
import java.util.Calendar;

import javax.swing.Action;
import javax.swing.Icon;
import javax.swing.JButton;
import javax.swing.JFileChooser;
import javax.swing.JOptionPane;
import javax.swing.UIManager;
import javax.swing.plaf.basic.BasicFileChooserUI;

import org.apache.commons.lang3.text.WordUtils;

import conv.ConventionException;
import epi.Project;
import model.CreateProjectModel;
import view.CreateProjectView;

public class CreateProjectController {
	private CreateProjectView 	_view;
	private CreateProjectModel 	_model;

	public void init(){
		int result = JOptionPane.showConfirmDialog(null, _view,"New project",JOptionPane.OK_CANCEL_OPTION,JOptionPane.PLAIN_MESSAGE);
		
		if(result==JOptionPane.OK_OPTION){
			
			Project project;
			try {
				project = new Project(0, _view.get_projectNameTxtField().getText(),Calendar.getInstance().get(Calendar.YEAR),Integer.valueOf(_view.get_versionComboBox().getSelectedItem().toString()),Calendar.getInstance().getTime());
				_model.create_project(project.get_folder_name());
				
				JFileChooser chooser = new JFileChooser();
				
				chooser.setSelectedFile(new File(project.get_folder_name()));
				chooser.setCurrentDirectory(new File("."));
				int returnValue = chooser.showSaveDialog(_view);
				chooser.setFileSelectionMode(JFileChooser.DIRECTORIES_ONLY);
				
				if(returnValue==JFileChooser.APPROVE_OPTION){
					try {
						_model.create_project(chooser.getSelectedFile());
						JOptionPane.showMessageDialog(null, "Project Created!","Success",JOptionPane.INFORMATION_MESSAGE);
					} catch (Exception e) {
						JOptionPane.showMessageDialog(null, e.getMessage(),"Error",JOptionPane.ERROR_MESSAGE);
					}
				}
			} catch (NumberFormatException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			} catch (ConventionException e) {
				JOptionPane.showMessageDialog(null, e.getMessage(),"Error",JOptionPane.ERROR_MESSAGE);
			}
		}
	}

	
	public CreateProjectController() {
		this._view = new CreateProjectView();
		this._model = CreateProjectModel.getInstance();
	}
	public CreateProjectView get_view() {
		return _view;
	}
	public void set_view(CreateProjectView _view) {
		this._view = _view;
	}
	public CreateProjectModel get_model() {
		return _model;
	}
	public void set_model(CreateProjectModel _model) {
		this._model = _model;
	}
}
