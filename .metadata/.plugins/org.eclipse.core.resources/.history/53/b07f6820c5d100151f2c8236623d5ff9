package app;

import java.io.IOException;
import java.rmi.NotBoundException;
import java.util.Calendar;
import javax.swing.JOptionPane;
import org.apache.commons.lang3.text.WordUtils;
import controller.CreateProjectController;
import controller.ServerController;
import controller.SyncController;

public class Model {

	private ServerController _serverController;
	private SyncController _syncController;

	public Model(){
		
		try {
			_serverController = new ServerController();
		} catch (IOException | NotBoundException e1) {
			JOptionPane.showMessageDialog(null, "Connection to the server cannot be established. This may due to an error in the config file, a network issue or a none running instance on the server.");
		}
		try {
			_syncController = new SyncController();
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (NotBoundException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	}
	
	public void create_new_project(){
		new CreateProjectController().init();
	}
	
	public void edit_server_status(){
		_serverController.show();
	}

	public String get_folder_name(String title, String species, String description, String project_name, String parent_path){
		Calendar cal = Calendar.getInstance();
		String year = String.valueOf(cal.get(Calendar.YEAR));
		String month = String.format("%02d",cal.get(Calendar.MONTH)+1);
		String day = String.format("%02d",cal.get(Calendar.DAY_OF_MONTH));
		
		String modified_title = WordUtils.capitalizeFully(title).replaceAll("\\s+", "");
		String modified_description = WordUtils.capitalizeFully(description).replaceAll("\\s", "");
		return parent_path+"/"+year+month+day+"_"+project_name+"_"+modified_title+"_"+species+"_"+modified_description;
	}

	public void sync_files() throws IOException, NotBoundException {
		_syncController.show();
	}
}
