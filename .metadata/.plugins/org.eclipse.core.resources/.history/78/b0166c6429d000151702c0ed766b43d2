package model;

import java.io.IOException;
import java.io.InputStream;
import java.rmi.NotBoundException;
import java.rmi.RemoteException;
import java.rmi.registry.LocateRegistry;
import java.rmi.registry.Registry;
import java.util.Properties;

import javax.swing.tree.TreePath;

import app.ProjectManagerInterface;

public class SyncModel {
	
	private Registry _registry;
	private ProjectManagerInterface _stub;
	
	public SyncModel() throws IOException, NotBoundException{
		Properties prop = new Properties();
		InputStream input = getClass().getClassLoader().getResourceAsStream("config.properties");
		prop.load(input);
		
		_registry = LocateRegistry.getRegistry(prop.getProperty("ip"),Integer.valueOf(prop.getProperty("port")));
		_stub = (ProjectManagerInterface) _registry.lookup("project_manager");
		_stub.getScratchTreeStructure().getModel().getRoot();
	}
	
	public void sendRequest(TreePath[] paths){
		for(int i=0;i<paths.length;i++){
			try {
				_stub.archivePath(paths[i]);
			} catch (RemoteException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
			//System.out.println(Arrays.toString(paths[i].getPath()));
			catch (IOException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			} catch (Exception e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
		}
	}

	public Registry get_registry() {
		return _registry;
	}

	public void set_registry(Registry _registry) {
		this._registry = _registry;
	}

	public ProjectManagerInterface get_stub() {
		return _stub;
	}

	public void set_stub(ProjectManagerInterface _stub) {
		this._stub = _stub;
	}

}
