package controller;

import java.io.IOException;
import java.rmi.NotBoundException;
import java.util.Calendar;

import app.PCR;
import view.GeneralInfoView;
import view.InfoFields;
import view.PCRView;
import epi.ServerInterface;
import jxl.read.biff.BiffException;
import jxl.write.WriteException;
import jxl.write.biff.RowsExceededException;

public class PCRController extends SpecificProjectController {
	
	private PCRView _view;
	private static PCRController instance = null;
	
	private PCRController(){
		super();
		_view = PCRView.getInstance();
		
		InfoFields.get_instance().get_generateBtn().addActionListener(new GenerateActionListener());
	}
	
	public static PCRController getInstance(){
		if(instance==null){
			instance = new PCRController();
		}
		return instance;
	}

	public void set_view(PCRView _view) {
		this._view = _view;
	}

	@Override
	public void experimentListChange(int index, String value) {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void reset() {
		_view.get_labelProtocolTxtArea().setText(null);
		_view.get_valueDefinitionTxtArea().setText(null);
	}


	@Override
	public GeneralInfoView get_view() {
		return _view;
	}

	@Override
	public void enable() {
		_view.get_labelProtocolTxtArea().setEnabled(true);
		_view.get_valueDefinitionTxtArea().setEnabled(true);
	}

	@Override
	public void disable() {
		_view.get_labelProtocolTxtArea().setEnabled(false);
		_view.get_valueDefinitionTxtArea().setEnabled(false);
	}

	@Override
	public void generate() throws IOException, RowsExceededException, WriteException, BiffException, NotBoundException, app.ConventionException {
		InfoFields fields = InfoFields.get_instance();
		PCR pcr = new PCR(-1,Calendar.getInstance(),fields.get_titleTxtField().getText(),fields.get_speciesComboBox().getSelectedItem().toString(),
				fields.get_descriptionTxtField().getText(),GeneralInfoController.getInstance().get_project(),fields.get_summaryTextArea().getText(),
				fields.get_overallDesignTxtArea().getText(),fields.get_contributorTxtField().getText(),fields.get_experimentList().getSelectedValue().toString(),
				fields.get_growthProtocolTxtArea().getText(),fields.get_treatmentProtocolTxtArea().getText(),
				fields.get_extractProtocolTxtArea().getText(),fields.get_dataProcessingTxtArea().getText(),
				fields.get_platformTxtField().getText(),_view.get_labelProtocolTxtArea().getText(),_view.get_valueDefinitionTxtArea().getText());
		
		ServerInterface.getInstance().get_stub().createPCRDirectory(pcr);
	}
}
